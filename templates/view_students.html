<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>View Students</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/static/style.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>
<body>

<div class="container container-narrow"> 
  <h2 class="mb-4 text-center">All Students</h2>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="flash flash-{{ category }}">{{ message }}</div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  {% if students %}
  <div class="card p-4 form-card">
    <div class="table-responsive">
      <table class="table table-striped align-middle table-hover">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Admission No</th>
            <th>Batch</th>
            <th style="min-width: 130px;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for student in students %}
          <tr>
            <td>{{ loop.index }}</td>
            <td>{{ student.name }}</td>
            <td>{{ student.admission_no }}</td>
            <td>{{ student.batch }}</td>
            <td>
              <a href="{{ url_for('edit_student', id=student.id) }}" class="btn btn-sm btn-outline-primary me-1">
                  <i class="bi bi-pencil-square"></i> Edit
              </a>
              <a href="#" 
                 class="btn btn-sm btn-outline-danger delete-student-btn"
                 data-bs-toggle="modal" 
                 data-bs-target="#deleteStudentModal" 
                 data-student-id="{{ student.id }}"
                 data-student-name="{{ student.name }}">
                  <i class="bi bi-trash"></i> Delete
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% else %}
  <p class="text-center text-muted p-3">No students have been added yet.</p>
  {% endif %}

  <a href="/" class="btn btn-secondary mt-3">Back to Dashboard</a>
</div>

<div class="modal fade" id="deleteStudentModal" tabindex="-1" aria-labelledby="deleteStudentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteStudentModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete the student: <strong id="studentNamePlaceholder"></strong>?
                <p class="text-danger mt-2">
                    <i class="bi bi-exclamation-triangle-fill me-1"></i>
                    Warning: You cannot delete a student with active book issues.
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a id="confirmDeleteStudentButton" class="btn btn-danger">Delete</a>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const deleteModal = document.getElementById('deleteStudentModal');
        const studentNamePlaceholder = document.getElementById('studentNamePlaceholder');
        const confirmDeleteButton = document.getElementById('confirmDeleteStudentButton');

        deleteModal.addEventListener('show.bs.modal', function (event) {
            const button = event.relatedTarget;
            const studentId = button.getAttribute('data-student-id');
            const studentName = button.getAttribute('data-student-name');
            
            studentNamePlaceholder.textContent = studentName;
            confirmDeleteButton.href = `/delete_student/${studentId}`;
        });
    });
</script>
</body>
</html>